{"version":3,"sources":["../src/main.js"],"names":["define","$","contrastErrors","errors","warnings","contrast","parseRgb","css","i","m","rgb","_i","_j","match","slice","contrastRatio","x","y","l1","relativeLuminance","l2","Math","max","min","c","lum","v","push","pow","getBackground","el","styles","getComputedStyle","bgColor","backgroundColor","bgImage","backgroundImage","tagName","parentNode","isVisible","offsetWidth","offsetHeight","getClientRects","length","check","elements","document","getElementById","querySelectorAll","n","elem","style","color","fill","htmlTag","background","textString","reduce","call","childNodes","a","b","nodeType","textContent","text","trim","ratingString","fontSizeString","failed","ratio","round","ratioText","fontSize","parseInt","fontWeight","error","name","detail","status","init","container","on","html","append","item","addClass","innerHTML","tooltip","boundary"],"mappings":"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","sourcesContent":["/* eslint-disable */\ndefine(\n[\n    'jquery',\n    'theme_boost/tooltip'\n],\nfunction(\n    $,\n    bstt\n) {\n\n    var contrastErrors = {\n        errors: [],\n        warnings: []\n    };\n    var contrast = {\n        // Parse rgb(r, g, b) and rgba(r, g, b, a) strings into an array.\n        // Adapted from https://github.com/gka/chroma.js\n        parseRgb: function (css) {\n            var i, m, rgb, _i, _j;\n            if (m = css.match(/rgb\\(\\s*(\\-?\\d+),\\s*(\\-?\\d+)\\s*,\\s*(\\-?\\d+)\\s*\\)/)) {\n                rgb = m.slice(1, 4);\n                for (i = _i = 0; _i <= 2; i = ++_i) {\n                    rgb[i] = +rgb[i];\n                }\n                rgb[3] = 1;\n            } else if (m = css.match(/rgba\\(\\s*(\\-?\\d+),\\s*(\\-?\\d+)\\s*,\\s*(\\-?\\d+)\\s*,\\s*([01]|[01]?\\.\\d+)\\)/)) {\n                rgb = m.slice(1, 5);\n                for (i = _j = 0; _j <= 3; i = ++_j) {\n                    rgb[i] = +rgb[i];\n                }\n            }\n            return rgb;\n        },\n        // Based on http://www.w3.org/TR/WCAG20/#contrast-ratiodef\n        contrastRatio: function (x, y) {\n            var l1 = contrast.relativeLuminance(contrast.parseRgb(x));\n            var l2 = contrast.relativeLuminance(contrast.parseRgb(y));\n            return (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);\n        },\n        // Based on http://www.w3.org/TR/WCAG20/#relativeluminancedef\n        relativeLuminance: function (c) {\n            var lum = [];\n            for (var i = 0; i < 3; i++) {\n                var v = c[i] / 255;\n                lum.push(v < 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4));\n            }\n            return 0.2126 * lum[0] + 0.7152 * lum[1] + 0.0722 * lum[2];\n        },\n        getBackground: function (el) {\n\n            var styles = getComputedStyle(el),\n                bgColor = styles.backgroundColor,\n                bgImage = styles.backgroundImage;\n\n            if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent' && bgImage === \"none\") {\n                return bgColor;\n            } else if (bgImage !== \"none\") {\n                return \"image\";\n            }\n\n            if (el.tagName === 'HTML') {\n                return 'rgb(255, 255, 255)';\n            } else {\n                return contrast.getBackground(el.parentNode);\n            }\n        },\n        // check visibility - based on jQuery method\n        isVisible: function (el) {\n            return !!(el.offsetWidth || el.offsetHeight || el.getClientRects().length);\n        },\n        check: function () {\n            var elements = document.getElementById('check-wcag').querySelectorAll('*');\n            for (var i = 0; i < elements.length; i++) {\n                (function (n) {\n                    var elem = elements[n];\n                    // test if visible\n                    //if (contrast.isVisible(elem)) {\n                        var style = getComputedStyle(elem),\n                            color = style.color,\n                            fill = style.fill,\n                            htmlTag = elem.tagName,\n                            background = contrast.getBackground(elem),\n                            textString = [].reduce.call(elem.childNodes, function (a, b) {\n                                return a + (b.nodeType === 3 ? b.textContent : '');\n                            }, ''),\n                            text = textString.trim(),\n                            ratingString,\n                            fontSizeString,\n                            failed;\n\n                        if (htmlTag === \"svg\") {\n                           var  ratio = Math.round(contrast.contrastRatio(fill, background) * 100) / 100,\n                                ratioText = ratio + ':1';\n                            if(ratio < 3) {\n                                failed=\"true\";\n                                fontSizeString = \"svg fill\";\n                                ratingString = \"fail\"\n                            }\n                        } else if (text.length) {\n                            // does element have a background image - needs to be manually reviewed\n                            if (background === \"image\") {\n                                ratingString = \"Needs manual review\";\n                                fontSizeString = \"N/A\";\n                                failed = true;\n                            } else {\n                                var ratio = Math.round(contrast.contrastRatio(color, background) * 100) / 100,\n                                    ratioText = ratio + ':1',\n                                    fontSize = parseInt(style.fontSize), \n                                    fontWeight = style.fontWeight;\n                                if (fontSize >= 18 || fontSize >= 14 && fontWeight >= 700) {\n                                    fontSizeString = 'large scale text'\n                                    if (ratio < 3) {\n                                        ratingString = 'fail';\n                                        failed = true;\n                                    } else {\n                                        ratingString = 'pass';\n                                        failed = false;\n                                    }\n                                } else {\n                                    fontSizeString = 'normal body text'\n                                    if (ratio < 4.5) {\n                                        ratingString = 'fail';\n                                        failed = true;\n                                    } else {\n                                        ratingString = 'pass';\n                                        failed = false;\n                                    }\n                                }\n                            }\n                        }\n\n                        // highlight the element in the DOM and log the element, contrast ratio and failure\n                        // for testing in console\n                        if (failed) {\n                            var error = {};\n                            error = {\n                                name: elem,\n                                ratio: ratioText,\n                                detail: fontSizeString,\n                                status: ratingString\n                            }\n                            if(ratingString === \"fail\"){\n                                contrastErrors.errors.push(error);\n                            } else if (ratingString === \"Needs manual review\"){\n                                contrastErrors.warnings.push(error);\n                            }\n                        }\n                    //}\n                })(i);\n            }\n            return contrastErrors;\n        }\n    }\n\n        /**\n     * Initialise all of the modules for the overview block.\n     *\n     * @param {object} root The root element for the overview block.\n     */\n    var init = function(root) {\n        container = $('#check-wcag');\n        container.on('click', function () {\n            contrast.check();\n            $('div.errors').html('');\n            $('div.warnings').html('');\n            $('div.errors').append('<h3 class=\"error-highlight\">Errors</h3>');\n            $('div.warnings').append('<h3 class=\"warning-highlight\">Warnings</h3>')\n            $('div.errors, div.warnings').append('<ol></ol>');\n\n            for (var i = 0; i < contrastErrors.errors.length; i++) {\n                var item = contrastErrors.errors[i];\n                $(item.name).addClass('error-highlight').append(' (' + i + ')');\n                $('div.errors ol').append(\n                    '<li>' + item.name.innerHTML + ': ' + item.ratio + '</li>'\n                );\n            }\n\n            for (var i = 0; i < contrastErrors.warnings.length; i++) {\n                var item = contrastErrors.warnings[i];\n                $(item.name).addClass('error-highlight').append(' (' + i + ')');\n                $('div.warnings ol').append(\n                    '<li>' + item.name.innerHTML + ': ' + item.ratio + '</li>'\n                );\n            }\n\n        });\n        $('.hastooltip').tooltip({ boundary: 'window' });\n    }\n\n    return {\n        init: init\n    };\n});\n/* eslint-enable */"],"file":"main.min.js"}